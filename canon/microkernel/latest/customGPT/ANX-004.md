### ANX-004: Token Counting Utility and Measurement Spec

## 1. Canonical Tokenizer Definition

**PROTOCOL:** The canonical reference for all token counts, including $\tau$, $K_b$, $\mathbf{MI}$ numerators/denominators, and log fields, is the **`clown_v1`** tokenizer.

**`clown_v1` MAPPING:** This name logically maps to a **byte-level BPE tokenizer** (e.g., TikToken's GPT-3.5-Turbo mapping) known for its stability and public availability. Implementers **MUST** use this specific mapping to ensure $\mathbf{MI}$ is consistent across platforms, regardless of the underlying model's proprietary tokenizer.

## 2. Measurement Methodology

All token measurements must be distinct and non-overlapping.

| Measurement | Definition | Requirement |
| :--- | :--- | :--- |
| **Kernel Tokens ($K_t$)** | Total tokens consumed by the ingested Kernel document (v1.1). | **MUST** be $\le K_b$. Measured once at ingestion (K.R.1). |
| **Base Content Tokens ($B_t$)** | Tokens consumed by the Practitioner's current prompt. | Used as the $\mathbf{MI}$ denominator. **MUST NOT** include the MLP synthesis output. |
| **MLP Tokens ($M_t$)** | Tokens consumed by the structured output of **LENS-01, LENS-02, and LENS-03** as defined in **ANX-005**. | Used as the $\mathbf{MI}$ numerator. Measured by the Adapter:compute. |
| **Log/Glyph Tokens ($L_t$)** | Tokens consumed by the final `LOG:` line and embedded glyphs (e.g., $\mathbf{\text{â¤­}}$). | Measured separately and logged to prevent double-counting. |

## 3. MI Calculation and Error Policy

**PROTOCOL:** The $\mathbf{MI}$ is calculated as per **K.R.16**: $MI = \frac{M_t}{B_t}$.

| Error Code | Trigger Condition | Remediation (K.R.8) |
| :--- | :--- | :--- |
| **E\_TOKENIZER\_DRIFT** | Validator's $B_t$ or $M_t$ measurement deviates $> 5\%$ from the logged $L_t$. | Refuse response; re-run measurement using byte-level validation of $B_t$ and $M_t$ against the **`clown_v1`** spec. |
| **E\_MLP\_DIV\_ZERO** | $B_t = 0$ (e.g., empty prompt). | Force $B_t = 1$ for $\mathbf{MI}$ calculation only; log $\mathbf{B\_FORCE}$ warning. |

---
