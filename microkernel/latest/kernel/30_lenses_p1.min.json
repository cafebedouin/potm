{
  "$schema":"https://json-schema.org/draft/2020-12/schema",
  "$id":"potm.lenses.p1.min.json",
  "type":"object",
  "required":["difficulty_levels","lenses"],
  "properties":{
    "difficulty_levels":{"type":"array","items":{"type":"string"}},
    "allowed_triggers":{"type":"array","items":{"type":"string"}},
    "defaults":{"type":"object"},
    "lenses":{
      "type":"array",
      "items":{
        "type":"object",
        "required":["id","gist","intent","outputs","difficulty","triggers","chains","selector_hint","cautions"],
        "properties":{
          "id":{"type":"string","pattern":"^[A-Z0-9_:-]+$"},
          "gist":{"type":"string"},
          "intent":{"type":"string"},
          "outputs":{"type":"array","items":{"type":"string"},"minItems":1},
          "difficulty":{"type":"string","enum":["gentle","medium","hard"]},
          "cautions":{"type":"array","items":{"type":"string"}},
          "selector_hint":{"type":"string"},
          "triggers":{
            "type":"array","minItems":1,
            "items":{"oneOf":[
              {"type":"object","required":["type","flag"],"properties":{"type":{"const":"assumption_present"},"flag":{"type":"boolean"}}},
              {"type":"object","required":["type","threshold"],"properties":{"type":{"const":"novelty_below"},"threshold":{"type":"number","minimum":0,"maximum":1}}},
              {"type":"object","required":["type","allow"],"properties":{"type":{"const":"manual"},"allow":{"type":"boolean"}}}
            ]}
          },
          "chains":{
            "type":"object","required":["next"],
            "properties":{
              "next":{"type":"array","items":{"type":"string"},"minItems":1},
              "max_chain_len":{"type":"integer","minimum":1},
              "cooldown_turns":{"type":"integer","minimum":0}
            }
          }
        },
        "additionalProperties": true
      }
    }
  },
  "additionalProperties": true
}
